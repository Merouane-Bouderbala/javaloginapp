- hosts: all
  become: true
  vars:
    ansible_sudo_pass: "{{ ansible_ssh_pass }}"
    ansible_python_interpreter: /usr/bin/python3
 
  tasks:
  
  - name: copy Dockerfile 
    copy: 
     src: /var/lib/jenkins/workspace/soufiane_test_3/Dockerfile
     dest: /opt/docker
     
  - name: copy war 
    copy: 
     src: /var/lib/jenkins/workspace/soufiane_test_3/target/bootcamp.war 
     dest: /opt/docker

  - name: Stop current container 
    docker_container: 
      name: soufiane_test_3-JLA-container 
      state: stopped
    ignore_errors: yes 

  - name: remove stopped container 
    docker_container: 
      name: soufiane_test_3-JLA-container 
      state: absent
    ignore_errors: true

  - name: remove docker images # Clean up task 
    docker_image:  
      name: soufiane_test_3-JLA-image:latest 
      state: absent 
    ignore_errors: yes 

  - name: create docker image using war file 
    docker_image: 
      name: soufiane_test_3-JLA-image:latest 
      build:
        path: /opt/docker
      state: present
      source: build

  - name: run container 
    docker_container: 
      name: soufiane_test_3-JLA-container
      state: started 
      image: soufiane_test_3-JLA-image:latest
      detach: yes 
      ports: 
      - "8082:8080" 
